import unittest

import numpy as np
from importlib_resources import path
from saddle.fchk import FCHKFile


class TestFormatCheck(unittest.TestCase):
    def test_water_fchk(self):
        with path('saddle.test.data', 'water_0.fchk') as fchk_path:
            f = FCHKFile(fchk_path)
        hessian = f.get_hessian()
        gradient = f.get_gradient()
        energy = f.get_energy()
        result_h = [[
            3.17131718e-02,
            -4.18734326e-18,
            -1.38547897e-18,
            -2.93155973e-02,
            -3.12557821e-18,
            6.43451786e-22,
            -2.39757454e-03,
            1.03805567e-17,
            2.74615253e-18,
        ], [
            -4.18734326e-18,
            -1.49385417e-02,
            3.33228038e-02,
            -3.55771944e-18,
            1.40893187e-02,
            -3.59538416e-02,
            3.09439885e-18,
            8.49222729e-04,
            2.63103801e-03,
        ], [
            -1.38547897e-18,
            3.33228038e-02,
            1.90370396e-02,
            7.51471617e-19,
            -3.06917656e-02,
            -2.56655894e-02,
            3.17532757e-18,
            -2.63103801e-03,
            6.62854966e-03,
        ], [
            -2.93155973e-02,
            -3.55771944e-18,
            7.51471617e-19,
            5.86311945e-02,
            -2.01776317e-16,
            -1.43495471e-16,
            -2.93155973e-02,
            2.20054701e-16,
            1.46795989e-16,
        ], [
            -3.12557821e-18,
            1.40893187e-02,
            -3.06917656e-02,
            -2.01776317e-16,
            -2.81786371e-02,
            -3.73661267e-10,
            2.27339208e-16,
            1.40893188e-02,
            3.06917656e-02,
        ], [
            6.43451786e-22,
            -3.59538416e-02,
            -2.56655894e-02,
            -1.43495471e-16,
            -3.73661267e-10,
            5.13311785e-02,
            1.46365044e-16,
            3.59538420e-02,
            -2.56655891e-02,
        ], [
            -2.39757454e-03,
            3.09439885e-18,
            3.17532757e-18,
            -2.93155973e-02,
            2.27339208e-16,
            1.46365044e-16,
            3.17131718e-02,
            -2.48221907e-16,
            -1.54953678e-16,
        ], [
            1.03805567e-17,
            8.49222729e-04,
            -2.63103801e-03,
            2.20054701e-16,
            1.40893188e-02,
            3.59538420e-02,
            -2.48221907e-16,
            -1.49385417e-02,
            -3.33228038e-02,
        ], [
            2.74615253e-18,
            2.63103801e-03,
            6.62854966e-03,
            1.46795989e-16,
            3.06917656e-02,
            -2.56655891e-02,
            -1.54953678e-16,
            -3.33228038e-02,
            1.90370396e-02,
        ]]
        result_g = [
            1.25447800e-17, 9.54806810e-02, -5.80237759e-02, 2.57560310e-16,
            1.31838984e-16, 1.16047552e-01, -2.70105090e-16, -9.54806810e-02,
            -5.80237759e-02
        ]
        result_e = -75.2323588708
        assert np.allclose(result_h, hessian)
        assert np.allclose(result_g, gradient)
        assert np.allclose(result_e, energy)
